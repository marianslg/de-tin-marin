---
export interface Props {
  id: string;
  images: string[];
  ms: number;
}
const { id, images, ms = 3000 } = Astro.props;
---

<div
  class="relative w-full aspect-square overflow-hidden"
  id={`carousel-container-${id}`}
>
  {
    images.map((image, index) => (
      <img
        src={image}
        alt=""
        class={`absolute inset-0 w-full h-full object-contain transition-transform duration-700 ease-in-out transform
          ${index === 0 ? 'translate-x-0' : 'translate-x-full invisible'}`}
      />
    ))
  }
</div>

<script is:inline define:vars={{ id, images, ms }}>
  if (images.length > 1) {
    let current = 0;
    const container = document.getElementById(`carousel-container-${id}`);
    const imgs = Array.from(container.querySelectorAll('img')); 

    setInterval(() => {
      const next = current === imgs.length - 1 ? 0 : current + 1;

      // 1) Hacemos visible el siguiente slide
      imgs[next].classList.remove('invisible');

      // 2) Preparamos y animamos: actual sale a la izq, siguiente entra desde la der.
      imgs[next].classList.replace('translate-x-0', 'translate-x-full');
      imgs[current].classList.replace('translate-x-0', '-translate-x-full');
      imgs[next].classList.replace('translate-x-full', 'translate-x-0');

      // 3) Al acabar la transiciÃ³n del actual, lo reposicionamos off-screen y lo ocultamos
      const onTransitionEnd = (e) => {
        if (e.propertyName !== 'transform') return;
        imgs[current].classList.replace('-translate-x-full', 'translate-x-full');
        imgs[current].classList.add('invisible');
        imgs[current].removeEventListener('transitionend', onTransitionEnd);
        current = next;
      };
      imgs[current].addEventListener('transitionend', onTransitionEnd);

    }, ms);
  }
</script>